"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.processResponseData = void 0;
const http_headers_1 = __importDefault(require("../../utils/http-headers"));
const content_types_1 = __importDefault(require("../../assets/content-types"));
const testcafe_hammerhead_1 = require("testcafe-hammerhead");
async function processResponseData(response, rawResponse = false) {
    if (rawResponse)
        return response;
    const data = await testcafe_hammerhead_1.promisifyStream(response);
    if (!response.headers[http_headers_1.default.contentType])
        return data;
    if (response.headers[http_headers_1.default.contentType].startsWith(content_types_1.default.textPlain) ||
        response.headers[http_headers_1.default.contentType].startsWith(content_types_1.default.textHtml))
        return data.toString('utf8');
    if (response.headers[http_headers_1.default.contentType].startsWith(content_types_1.default.json))
        return data.length ? JSON.parse(data.toString('utf8')) : '';
    return data;
}
exports.processResponseData = processResponseData;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvY2Vzcy1yZXNwb25zZS1kYXRhLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3Rlc3QtcnVuL3JlcXVlc3QvcHJvY2Vzcy1yZXNwb25zZS1kYXRhLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLDRFQUFvRDtBQUNwRCwrRUFBdUQ7QUFDdkQsNkRBQXNEO0FBRy9DLEtBQUssVUFBVSxtQkFBbUIsQ0FBRSxRQUF5QixFQUFFLFdBQVcsR0FBRyxLQUFLO0lBQ3JGLElBQUksV0FBVztRQUNYLE9BQU8sUUFBUSxDQUFDO0lBRXBCLE1BQU0sSUFBSSxHQUFHLE1BQU0scUNBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUU3QyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxzQkFBWSxDQUFDLFdBQVcsQ0FBQztRQUMzQyxPQUFPLElBQUksQ0FBQztJQUVoQixJQUFLLFFBQVEsQ0FBQyxPQUFPLENBQUMsc0JBQVksQ0FBQyxXQUFXLENBQVksQ0FBQyxVQUFVLENBQUMsdUJBQWEsQ0FBQyxTQUFTLENBQUM7UUFDekYsUUFBUSxDQUFDLE9BQU8sQ0FBQyxzQkFBWSxDQUFDLFdBQVcsQ0FBWSxDQUFDLFVBQVUsQ0FBQyx1QkFBYSxDQUFDLFFBQVEsQ0FBQztRQUN6RixPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7SUFFakMsSUFBSyxRQUFRLENBQUMsT0FBTyxDQUFDLHNCQUFZLENBQUMsV0FBVyxDQUFZLENBQUMsVUFBVSxDQUFDLHVCQUFhLENBQUMsSUFBSSxDQUFDO1FBQ3JGLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUVoRSxPQUFPLElBQUksQ0FBQztBQUNoQixDQUFDO0FBakJELGtEQWlCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluY29taW5nTWVzc2FnZSB9IGZyb20gJ2h0dHAnO1xuaW1wb3J0IEhUVFBfSEVBREVSUyBmcm9tICcuLi8uLi91dGlscy9odHRwLWhlYWRlcnMnO1xuaW1wb3J0IENPTlRFTlRfVFlQRVMgZnJvbSAnLi4vLi4vYXNzZXRzL2NvbnRlbnQtdHlwZXMnO1xuaW1wb3J0IHsgcHJvbWlzaWZ5U3RyZWFtIH0gZnJvbSAndGVzdGNhZmUtaGFtbWVyaGVhZCc7XG5pbXBvcnQgeyBSZXNwb25zZUJvZHkgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1Jlc3BvbnNlRGF0YSAocmVzcG9uc2U6IEluY29taW5nTWVzc2FnZSwgcmF3UmVzcG9uc2UgPSBmYWxzZSk6IFByb21pc2U8UmVzcG9uc2VCb2R5PiB7XG4gICAgaWYgKHJhd1Jlc3BvbnNlKVxuICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG5cbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcHJvbWlzaWZ5U3RyZWFtKHJlc3BvbnNlKTtcblxuICAgIGlmICghcmVzcG9uc2UuaGVhZGVyc1tIVFRQX0hFQURFUlMuY29udGVudFR5cGVdKVxuICAgICAgICByZXR1cm4gZGF0YTtcblxuICAgIGlmICgocmVzcG9uc2UuaGVhZGVyc1tIVFRQX0hFQURFUlMuY29udGVudFR5cGVdIGFzIHN0cmluZykuc3RhcnRzV2l0aChDT05URU5UX1RZUEVTLnRleHRQbGFpbikgfHxcbiAgICAgICAgKHJlc3BvbnNlLmhlYWRlcnNbSFRUUF9IRUFERVJTLmNvbnRlbnRUeXBlXSBhcyBzdHJpbmcpLnN0YXJ0c1dpdGgoQ09OVEVOVF9UWVBFUy50ZXh0SHRtbCkpXG4gICAgICAgIHJldHVybiBkYXRhLnRvU3RyaW5nKCd1dGY4Jyk7XG5cbiAgICBpZiAoKHJlc3BvbnNlLmhlYWRlcnNbSFRUUF9IRUFERVJTLmNvbnRlbnRUeXBlXSBhcyBzdHJpbmcpLnN0YXJ0c1dpdGgoQ09OVEVOVF9UWVBFUy5qc29uKSlcbiAgICAgICAgcmV0dXJuIGRhdGEubGVuZ3RoID8gSlNPTi5wYXJzZShkYXRhLnRvU3RyaW5nKCd1dGY4JykpIDogJyc7XG5cbiAgICByZXR1cm4gZGF0YTtcbn1cbiJdfQ==