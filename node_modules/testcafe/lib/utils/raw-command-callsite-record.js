"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawCommandCallsiteRecord = exports.renderers = exports.HtmlRender = exports.NoColorRender = exports.Render = void 0;
const chalk_1 = __importDefault(require("chalk"));
const lodash_1 = require("lodash");
class Render {
    static getCommandStr(command) {
        const { type, assertionType, selector, actual, expected, } = command;
        const mainStr = `${lodash_1.upperFirst(lodash_1.camelCase(type))} (${(assertionType ? actual === null || actual === void 0 ? void 0 : actual.value : selector === null || selector === void 0 ? void 0 : selector.value) || ''})`;
        const subStr = assertionType ? ` ${assertionType} (${(expected === null || expected === void 0 ? void 0 : expected.value) || ''})` : '';
        return `${mainStr}${subStr}`;
    }
    static codeFrame(str) {
        return str;
    }
    static commandLine(num, command, base) {
        let commandNum = `${base ? ' > ' : '   '}${num} `;
        if (base)
            commandNum = chalk_1.default.bgRed(commandNum);
        return `${commandNum}|${Render.getCommandStr(command)}\n`;
    }
}
exports.Render = Render;
class NoColorRender extends Render {
    static commandLine(num, command, base) {
        const commandNum = `${base ? ' > ' : '   '}${num} `;
        return `${commandNum}|${Render.getCommandStr(command)}\n`;
    }
}
exports.NoColorRender = NoColorRender;
class HtmlRender extends Render {
    static codeFrame(str) {
        return '<div class="code-frame">' + str + '</div>';
    }
    static commandLine(num, command, base) {
        const numClass = base ? 'code-line-num-base' : 'code-line-num';
        return `<div class="code-line">` +
            `<div class="${numClass}">${num}</div>` +
            `<div class="code-line-src">${Render.getCommandStr(command)}</div>` +
            `</div>`;
    }
}
exports.HtmlRender = HtmlRender;
exports.renderers = {
    default: Render,
    html: HtmlRender,
    noColor: NoColorRender,
};
class RawCommandCallsiteRecord {
    constructor(actionId, list) {
        this.actionId = actionId;
        this._list = list;
    }
    renderSync(opts) {
        const { renderer = Render, frameSize = 1, codeFrame = true, } = opts;
        if (!codeFrame)
            return '';
        const baseId = this._list.findIndex(item => item.actionId === this.actionId);
        if (baseId < 0)
            return '';
        const firstId = Math.max(baseId - frameSize, 0);
        const lastId = Math.min(baseId + frameSize, this._list.length - 1);
        let frame = '';
        for (let i = firstId; i <= lastId; i++)
            frame += renderer.commandLine(i + 1, this._list[i], i === baseId);
        return renderer.codeFrame(frame);
    }
}
exports.RawCommandCallsiteRecord = RawCommandCallsiteRecord;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF3LWNvbW1hbmQtY2FsbHNpdGUtcmVjb3JkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzL3Jhdy1jb21tYW5kLWNhbGxzaXRlLXJlY29yZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxrREFBMEI7QUFDMUIsbUNBQStDO0FBcUIvQyxNQUFhLE1BQU07SUFDUixNQUFNLENBQUMsYUFBYSxDQUFFLE9BQWdCO1FBQ3pDLE1BQU0sRUFDRixJQUFJLEVBQ0osYUFBYSxFQUNiLFFBQVEsRUFDUixNQUFNLEVBQ04sUUFBUSxHQUNYLEdBQUcsT0FBTyxDQUFDO1FBRVosTUFBTSxPQUFPLEdBQUcsR0FBRyxtQkFBVSxDQUFDLGtCQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxhQUFSLFFBQVEsdUJBQVIsUUFBUSxDQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDO1FBQzlHLE1BQU0sTUFBTSxHQUFJLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxhQUFhLEtBQUssQ0FBQSxRQUFRLGFBQVIsUUFBUSx1QkFBUixRQUFRLENBQUUsS0FBSyxLQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFcEYsT0FBTyxHQUFHLE9BQU8sR0FBRyxNQUFNLEVBQUUsQ0FBQztJQUNqQyxDQUFDO0lBQ00sTUFBTSxDQUFDLFNBQVMsQ0FBRSxHQUFXO1FBQ2hDLE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUNNLE1BQU0sQ0FBQyxXQUFXLENBQUUsR0FBVyxFQUFFLE9BQWdCLEVBQUUsSUFBYTtRQUNuRSxJQUFJLFVBQVUsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsR0FBRyxH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Q0QsNERBaUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGNoYWxrIGZyb20gJ2NoYWxrJztcbmltcG9ydCB7IGNhbWVsQ2FzZSwgdXBwZXJGaXJzdCB9IGZyb20gJ2xvZGFzaCc7XG5cbmludGVyZmFjZSBDb21tYW5kIHtcbiAgICBpZDogbnVtYmVyO1xuICAgIHNlbGVjdG9yPzoge1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgfTtcbiAgICBhY3R1YWw/OiB7XG4gICAgICAgIHR5cGU6IHN0cmluZztcbiAgICAgICAgdmFsdWU6IHN0cmluZztcbiAgICB9O1xuICAgIGV4cGVjdGVkPzoge1xuICAgICAgICB0eXBlOiBzdHJpbmc7XG4gICAgICAgIHZhbHVlOiBzdHJpbmc7XG4gICAgfTtcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgYXNzZXJ0aW9uVHlwZT86IHN0cmluZztcbiAgICBba2V5OiBzdHJpbmddOiB1bmtub3duO1xufVxuXG5leHBvcnQgY2xhc3MgUmVuZGVyIHtcbiAgICBwdWJsaWMgc3RhdGljIGdldENvbW1hbmRTdHIgKGNvbW1hbmQ6IENvbW1hbmQpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICB0eXBlLFxuICAgICAgICAgICAgYXNzZXJ0aW9uVHlwZSxcbiAgICAgICAgICAgIHNlbGVjdG9yLFxuICAgICAgICAgICAgYWN0dWFsLFxuICAgICAgICAgICAgZXhwZWN0ZWQsXG4gICAgICAgIH0gPSBjb21tYW5kO1xuXG4gICAgICAgIGNvbnN0IG1haW5TdHIgPSBgJHt1cHBlckZpcnN0KGNhbWVsQ2FzZSh0eXBlKSl9ICgkeyhhc3NlcnRpb25UeXBlID8gYWN0dWFsPy52YWx1ZSA6IHNlbGVjdG9yPy52YWx1ZSkgfHwgJyd9KWA7XG4gICAgICAgIGNvbnN0IHN1YlN0ciAgPSBhc3NlcnRpb25UeXBlID8gYCAke2Fzc2VydGlvblR5cGV9ICgke2V4cGVjdGVkPy52YWx1ZSB8fCAnJ30pYCA6ICcnO1xuXG4gICAgICAgIHJldHVybiBgJHttYWluU3RyfSR7c3ViU3RyfWA7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgY29kZUZyYW1lIChzdHI6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBzdHI7XG4gICAgfVxuICAgIHB1YmxpYyBzdGF0aWMgY29tbWFuZExpbmUgKG51bTogbnVtYmVyLCBjb21tYW5kOiBDb21tYW5kLCBiYXNlOiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IGNvbW1hbmROdW0gPSBgJHtiYXNlID8gJyA+ICcgOiAnICAgJ30ke251bX0gYDtcblxuICAgICAgICBpZiAoYmFzZSlcbiAgICAgICAgICAgIGNvbW1hbmROdW0gPSBjaGFsay5iZ1JlZChjb21tYW5kTnVtKTtcblxuICAgICAgICByZXR1cm4gYCR7Y29tbWFuZE51bX18JHtSZW5kZXIuZ2V0Q29tbWFuZFN0cihjb21tYW5kKX1cXG5gO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIE5vQ29sb3JSZW5kZXIgZXh0ZW5kcyBSZW5kZXIge1xuICAgIHB1YmxpYyBzdGF0aWMgY29tbWFuZExpbmUgKG51bTogbnVtYmVyLCBjb21tYW5kOiBDb21tYW5kLCBiYXNlOiBib29sZWFuKTogc3RyaW5nIHtcbiAgICAgICAgY29uc3QgY29tbWFuZE51bSA9IGAke2Jhc2UgPyAnID4gJyA6ICcgICAnfSR7bnVtfSBgO1xuXG4gICAgICAgIHJldHVybiBgJHtjb21tYW5kTnVtfXwke1JlbmRlci5nZXRDb21tYW5kU3RyKGNvbW1hbmQpfVxcbmA7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgSHRtbFJlbmRlciBleHRlbmRzIFJlbmRlciB7XG4gICAgcHVibGljIHN0YXRpYyBjb2RlRnJhbWUgKHN0cjogc3RyaW5nKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPVwiY29kZS1mcmFtZVwiPicgKyBzdHIgKyAnPC9kaXY+JztcbiAgICB9XG5cbiAgICBwdWJsaWMgc3RhdGljIGNvbW1hbmRMaW5lIChudW06IG51bWJlciwgY29tbWFuZDogQ29tbWFuZCwgYmFzZTogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgICAgIGNvbnN0IG51bUNsYXNzICA9IGJhc2UgPyAnY29kZS1saW5lLW51bS1iYXNlJyA6ICdjb2RlLWxpbmUtbnVtJztcblxuICAgICAgICByZXR1cm4gYDxkaXYgY2xhc3M9XCJjb2RlLWxpbmVcIj5gICtcbiAgICAgICAgICAgIGA8ZGl2IGNsYXNzPVwiJHtudW1DbGFzc31cIj4ke251bX08L2Rpdj5gICtcbiAgICAgICAgICAgIGA8ZGl2IGNsYXNzPVwiY29kZS1saW5lLXNyY1wiPiR7UmVuZGVyLmdldENvbW1hbmRTdHIoY29tbWFuZCl9PC9kaXY+YCArXG4gICAgICAgICAgICBgPC9kaXY+YDtcbiAgICB9XG59XG5cbmludGVyZmFjZSBSZW5kZXJPcHRpb25zIHtcbiAgICByZW5kZXJlcj86IHR5cGVvZiBSZW5kZXI7XG4gICAgZnJhbWVTaXplPzogbnVtYmVyO1xuICAgIGNvZGVGcmFtZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCByZW5kZXJlcnMgPSB7XG4gICAgZGVmYXVsdDogUmVuZGVyLFxuICAgIGh0bWw6ICAgIEh0bWxSZW5kZXIsXG4gICAgbm9Db2xvcjogTm9Db2xvclJlbmRlcixcbn07XG5cbmV4cG9ydCBjbGFzcyBSYXdDb21tYW5kQ2FsbHNpdGVSZWNvcmQge1xuICAgIHB1YmxpYyByZWFkb25seSBhY3Rpb25JZDogbnVtYmVyO1xuICAgIHByaXZhdGUgcmVhZG9ubHkgX2xpc3Q6IENvbW1hbmRbXTtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvciAoYWN0aW9uSWQ6IG51bWJlciwgbGlzdDogQ29tbWFuZFtdKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uSWQgPSBhY3Rpb25JZDtcbiAgICAgICAgdGhpcy5fbGlzdCAgICA9IGxpc3Q7XG4gICAgfVxuXG4gICAgcHVibGljIHJlbmRlclN5bmMgKG9wdHM6IFJlbmRlck9wdGlvbnMpOiBzdHJpbmcge1xuICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICByZW5kZXJlciA9IFJlbmRlcixcbiAgICAgICAgICAgIGZyYW1lU2l6ZSA9IDEsXG4gICAgICAgICAgICBjb2RlRnJhbWUgPSB0cnVlLFxuICAgICAgICB9ID0gb3B0cztcblxuICAgICAgICBpZiAoIWNvZGVGcmFtZSlcbiAgICAgICAgICAgIHJldHVybiAnJztcblxuICAgICAgICBjb25zdCBiYXNlSWQgPSB0aGlzLl9saXN0LmZpbmRJbmRleChpdGVtID0+IGl0ZW0uYWN0aW9uSWQgPT09IHRoaXMuYWN0aW9uSWQpO1xuXG4gICAgICAgIGlmIChiYXNlSWQgPCAwKVxuICAgICAgICAgICAgcmV0dXJuICcnO1xuXG4gICAgICAgIGNvbnN0IGZpcnN0SWQgPSBNYXRoLm1heChiYXNlSWQgLSBmcmFtZVNpemUsIDApO1xuICAgICAgICBjb25zdCBsYXN0SWQgID0gTWF0aC5taW4oYmFzZUlkICsgZnJhbWVTaXplLCB0aGlzLl9saXN0Lmxlbmd0aCAtIDEpO1xuICAgICAgICBsZXQgZnJhbWUgICAgID0gJyc7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IGZpcnN0SWQ7IGkgPD0gbGFzdElkOyBpKyspXG4gICAgICAgICAgICBmcmFtZSArPSByZW5kZXJlci5jb21tYW5kTGluZShpICsgMSwgdGhpcy5fbGlzdFtpXSwgaSA9PT0gYmFzZUlkKTtcblxuICAgICAgICByZXR1cm4gcmVuZGVyZXIuY29kZUZyYW1lKGZyYW1lKTtcbiAgICB9XG59XG4iXX0=