"use strict";
var __rest = (this && this.__rest) || function (s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                t[p[i]] = s[p[i]];
        }
    return t;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const base_1 = __importDefault(require("../base"));
const runtime_1 = require("../../../errors/runtime");
const types_1 = require("../../../errors/types");
const test_file_1 = __importDefault(require("../../../api/structure/test-file"));
const fixture_1 = __importDefault(require("../../../api/structure/fixture"));
const test_1 = __importDefault(require("../../../api/structure/test"));
const from_object_1 = __importDefault(require("../../../test-run/commands/from-object"));
const raw_command_callsite_record_1 = require("../../../utils/raw-command-callsite-record");
class RawTestFileCompiler extends base_1.default {
    static _createTestFn(commands) {
        return async (t) => {
            for (let i = 0; i < commands.length; i++) {
                const _a = commands[i], { actionId: initActionId, callsite: initCallsite } = _a, commandObj = __rest(_a, ["actionId", "callsite"]);
                const actionId = initActionId || parseInt(initCallsite, 10);
                const callsite = actionId ? new raw_command_callsite_record_1.RawCommandCallsiteRecord(actionId, commands) : initCallsite || initActionId;
                try {
                    const command = from_object_1.default(commandObj, t.testRun);
                    await t.testRun.executeCommand(command, callsite);
                }
                catch (err) {
                    err.callsite = callsite;
                    err.actionId = initActionId;
                    throw err;
                }
            }
        };
    }
    static _assignCommonTestingUnitProperties(src, dest) {
        if (src.pageUrl)
            dest.page(src.pageUrl);
        if (src.authCredentials)
            dest.httpAuth(src.authCredentials);
        /* eslint-disable no-unused-expressions */
        if (src.only)
            dest.only;
        if (src.skip)
            dest.skip;
        if (src.disablePageReloads)
            dest.disablePageReloads;
        if (src.enablePageReloads)
            dest.enablePageReloads;
        /* eslint-enable no-unused-expressions */
    }
    static _addTest(testFile, src, baseUrl) {
        const test = new test_1.default(testFile, false, baseUrl);
        test(src.name, RawTestFileCompiler._createTestFn(src.commands));
        RawTestFileCompiler._assignCommonTestingUnitProperties(src, test);
        if (src.beforeCommands)
            test.before(RawTestFileCompiler._createTestFn(src.beforeCommands));
        if (src.afterCommands)
            test.after(RawTestFileCompiler._createTestFn(src.afterCommands));
        return test;
    }
    static _addFixture(testFile, src, baseUrl) {
        const fixture = new fixture_1.default(testFile, baseUrl);
        fixture(src.name);
        RawTestFileCompiler._assignCommonTestingUnitProperties(src, fixture);
        if (src.beforeEachCommands)
            fixture.beforeEach(RawTestFileCompiler._createTestFn(src.beforeEachCommands));
        if (src.afterEachCommands)
            fixture.afterEach(RawTestFileCompiler._createTestFn(src.afterEachCommands));
        src.tests.forEach(testSrc => RawTestFileCompiler._addTest(testFile, testSrc, baseUrl));
    }
    _hasTests() {
        return true;
    }
    getSupportedExtension() {
        return '.testcafe';
    }
    compile(code, filename) {
        const testFile = new test_file_1.default(filename);
        let data = null;
        try {
            data = JSON.parse(code);
            data.fixtures.forEach(fixtureSrc => RawTestFileCompiler._addFixture(testFile, fixtureSrc, this.baseUrl));
            return testFile.getTests();
        }
        catch (err) {
            throw new runtime_1.GeneralError(types_1.RUNTIME_ERRORS.cannotParseRawFile, filename, err.toString());
        }
    }
}
exports.default = RawTestFileCompiler;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmF3LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbXBpbGVyL3Rlc3QtZmlsZS9mb3JtYXRzL3Jhdy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsbURBQTJDO0FBQzNDLHFEQUF1RDtBQUN2RCxpREFBdUQ7QUFDdkQsaUZBQXdEO0FBQ3hELDZFQUFxRDtBQUNyRCx1RUFBK0M7QUFDL0MseUZBQTZFO0FBQzdFLDRGQUFzRjtBQUV0RixNQUFxQixtQkFBb0IsU0FBUSxjQUFvQjtJQUVqRSxNQUFNLENBQUMsYUFBYSxDQUFFLFFBQVE7UUFDMUIsT0FBTyxLQUFLLEVBQUMsQ0FBQyxFQUFDLEVBQUU7WUFDYixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDdEMsTUFBTSxLQUlGLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFKVCxFQUNGLFFBQVEsRUFBRSxZQUFZLEVBQ3RCLFFBQVEsRUFBRSxZQUFZLE9BRVgsRUFEUixVQUFVLGNBSFgsd0JBSUwsQ0FBYyxDQUFDO2dCQUNoQixNQUFNLFFBQVEsR0FBRyxZQUFZLElBQUksUUFBUSxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDNUQsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLHNEQUF3QixDQUFDLFFBQVEsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsWUFBWSxJQUFJLFlBQVksQ0FBQztnQkFFNUcsSUFBSTtvQkFDQSxNQUFNLE9BQU8sR0FBRyxxQkFBdUIsQ0FBQyxVQUFVLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO29CQUUvRCxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsQ0FBQztpQkFDckQ7Z0JBQ0QsT0FBTyxHQUFHLEVB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QztRQUV4QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFFaEIsSUFBSTtZQUNBLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXhCLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsbUJBQW1CLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFFekcsT0FBTyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7U0FDOUI7UUFDRCxPQUFPLEdBQUcsRUFBRTtZQUNSLE1BQU0sSUFBSSxzQkFBWSxDQUFDLHNCQUFjLENBQUMsa0JBQWtCLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1NBQ3ZGO0lBQ0wsQ0FBQztDQUNKO0FBekdELHNDQXlHQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBUZXN0RmlsZUNvbXBpbGVyQmFzZSBmcm9tICcuLi9iYXNlJztcbmltcG9ydCB7IEdlbmVyYWxFcnJvciB9IGZyb20gJy4uLy4uLy4uL2Vycm9ycy9ydW50aW1lJztcbmltcG9ydCB7IFJVTlRJTUVfRVJST1JTIH0gZnJvbSAnLi4vLi4vLi4vZXJyb3JzL3R5cGVzJztcbmltcG9ydCBUZXN0RmlsZSBmcm9tICcuLi8uLi8uLi9hcGkvc3RydWN0dXJlL3Rlc3QtZmlsZSc7XG5pbXBvcnQgRml4dHVyZSBmcm9tICcuLi8uLi8uLi9hcGkvc3RydWN0dXJlL2ZpeHR1cmUnO1xuaW1wb3J0IFRlc3QgZnJvbSAnLi4vLi4vLi4vYXBpL3N0cnVjdHVyZS90ZXN0JztcbmltcG9ydCBjcmVhdGVDb21tYW5kRnJvbU9iamVjdCBmcm9tICcuLi8uLi8uLi90ZXN0LXJ1bi9jb21tYW5kcy9mcm9tLW9iamVjdCc7XG5pbXBvcnQgeyBSYXdDb21tYW5kQ2FsbHNpdGVSZWNvcmQgfSBmcm9tICcuLi8uLi8uLi91dGlscy9yYXctY29tbWFuZC1jYWxsc2l0ZS1yZWNvcmQnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBSYXdUZXN0RmlsZUNvbXBpbGVyIGV4dGVuZHMgVGVzdEZpbGVDb21waWxlckJhc2Uge1xuXG4gICAgc3RhdGljIF9jcmVhdGVUZXN0Rm4gKGNvbW1hbmRzKSB7XG4gICAgICAgIHJldHVybiBhc3luYyB0ID0+IHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tbWFuZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbklkOiBpbml0QWN0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgIGNhbGxzaXRlOiBpbml0Q2FsbHNpdGUsXG4gICAgICAgICAgICAgICAgICAgIC4uLmNvbW1hbmRPYmpcbiAgICAgICAgICAgICAgICB9ID0gY29tbWFuZHNbaV07XG4gICAgICAgICAgICAgICAgY29uc3QgYWN0aW9uSWQgPSBpbml0QWN0aW9uSWQgfHwgcGFyc2VJbnQoaW5pdENhbGxzaXRlLCAxMCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY2FsbHNpdGUgPSBhY3Rpb25JZCA/IG5ldyBSYXdDb21tYW5kQ2FsbHNpdGVSZWNvcmQoYWN0aW9uSWQsIGNvbW1hbmRzKSA6IGluaXRDYWxsc2l0ZSB8fCBpbml0QWN0aW9uSWQ7XG5cbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb21tYW5kID0gY3JlYXRlQ29tbWFuZEZyb21PYmplY3QoY29tbWFuZE9iaiwgdC50ZXN0UnVuKTtcblxuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0LnRlc3RSdW4uZXhlY3V0ZUNvbW1hbmQoY29tbWFuZCwgY2FsbHNpdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGVyci5jYWxsc2l0ZSAgPSBjYWxsc2l0ZTtcbiAgICAgICAgICAgICAgICAgICAgZXJyLmFjdGlvbklkICA9IGluaXRBY3Rpb25JZDtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBzdGF0aWMgX2Fzc2lnbkNvbW1vblRlc3RpbmdVbml0UHJvcGVydGllcyAoc3JjLCBkZXN0KSB7XG4gICAgICAgIGlmIChzcmMucGFnZVVybClcbiAgICAgICAgICAgIGRlc3QucGFnZShzcmMucGFnZVVybCk7XG5cbiAgICAgICAgaWYgKHNyYy5hdXRoQ3JlZGVudGlhbHMpXG4gICAgICAgICAgICBkZXN0Lmh0dHBBdXRoKHNyYy5hdXRoQ3JlZGVudGlhbHMpO1xuXG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXVudXNlZC1leHByZXNzaW9ucyAqL1xuICAgICAgICBpZiAoc3JjLm9ubHkpXG4gICAgICAgICAgICBkZXN0Lm9ubHk7XG5cbiAgICAgICAgaWYgKHNyYy5za2lwKVxuICAgICAgICAgICAgZGVzdC5za2lwO1xuXG4gICAgICAgIGlmIChzcmMuZGlzYWJsZVBhZ2VSZWxvYWRzKVxuICAgICAgICAgICAgZGVzdC5kaXNhYmxlUGFnZVJlbG9hZHM7XG5cbiAgICAgICAgaWYgKHNyYy5lbmFibGVQYWdlUmVsb2FkcylcbiAgICAgICAgICAgIGRlc3QuZW5hYmxlUGFnZVJlbG9hZHM7XG4gICAgICAgIC8qIGVzbGludC1lbmFibGUgbm8tdW51c2VkLWV4cHJlc3Npb25zICovXG4gICAgfVxuXG4gICAgc3RhdGljIF9hZGRUZXN0ICh0ZXN0RmlsZSwgc3JjLCBiYXNlVXJsKSB7XG4gICAgICAgIGNvbnN0IHRlc3QgPSBuZXcgVGVzdCh0ZXN0RmlsZSwgZmFsc2UsIGJhc2VVcmwpO1xuXG4gICAgICAgIHRlc3Qoc3JjLm5hbWUsIFJhd1Rlc3RGaWxlQ29tcGlsZXIuX2NyZWF0ZVRlc3RGbihzcmMuY29tbWFuZHMpKTtcblxuICAgICAgICBSYXdUZXN0RmlsZUNvbXBpbGVyLl9hc3NpZ25Db21tb25UZXN0aW5nVW5pdFByb3BlcnRpZXMoc3JjLCB0ZXN0KTtcblxuICAgICAgICBpZiAoc3JjLmJlZm9yZUNvbW1hbmRzKVxuICAgICAgICAgICAgdGVzdC5iZWZvcmUoUmF3VGVzdEZpbGVDb21waWxlci5fY3JlYXRlVGVzdEZuKHNyYy5iZWZvcmVDb21tYW5kcykpO1xuXG4gICAgICAgIGlmIChzcmMuYWZ0ZXJDb21tYW5kcylcbiAgICAgICAgICAgIHRlc3QuYWZ0ZXIoUmF3VGVzdEZpbGVDb21waWxlci5fY3JlYXRlVGVzdEZuKHNyYy5hZnRlckNvbW1hbmRzKSk7XG5cbiAgICAgICAgcmV0dXJuIHRlc3Q7XG4gICAgfVxuXG4gICAgc3RhdGljIF9hZGRGaXh0dXJlICh0ZXN0RmlsZSwgc3JjLCBiYXNlVXJsKSB7XG4gICAgICAgIGNvbnN0IGZpeHR1cmUgPSBuZXcgRml4dHVyZSh0ZXN0RmlsZSwgYmFzZVVybCk7XG5cbiAgICAgICAgZml4dHVyZShzcmMubmFtZSk7XG5cbiAgICAgICAgUmF3VGVzdEZpbGVDb21waWxlci5fYXNzaWduQ29tbW9uVGVzdGluZ1VuaXRQcm9wZXJ0aWVzKHNyYywgZml4dHVyZSk7XG5cbiAgICAgICAgaWYgKHNyYy5iZWZvcmVFYWNoQ29tbWFuZHMpXG4gICAgICAgICAgICBmaXh0dXJlLmJlZm9yZUVhY2goUmF3VGVzdEZpbGVDb21waWxlci5fY3JlYXRlVGVzdEZuKHNyYy5iZWZvcmVFYWNoQ29tbWFuZHMpKTtcblxuICAgICAgICBpZiAoc3JjLmFmdGVyRWFjaENvbW1hbmRzKVxuICAgICAgICAgICAgZml4dHVyZS5hZnRlckVhY2goUmF3VGVzdEZpbGVDb21waWxlci5fY3JlYXRlVGVzdEZuKHNyYy5hZnRlckVhY2hDb21tYW5kcykpO1xuXG4gICAgICAgIHNyYy50ZXN0cy5mb3JFYWNoKHRlc3RTcmMgPT4gUmF3VGVzdEZpbGVDb21waWxlci5fYWRkVGVzdCh0ZXN0RmlsZSwgdGVzdFNyYywgYmFzZVVybCkpO1xuICAgIH1cblxuICAgIF9oYXNUZXN0cyAoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGdldFN1cHBvcnRlZEV4dGVuc2lvbiAoKSB7XG4gICAgICAgIHJldHVybiAnLnRlc3RjYWZlJztcbiAgICB9XG5cbiAgICBjb21waWxlIChjb2RlLCBmaWxlbmFtZSkge1xuICAgICAgICBjb25zdCB0ZXN0RmlsZSA9IG5ldyBUZXN0RmlsZShmaWxlbmFtZSk7XG5cbiAgICAgICAgbGV0IGRhdGEgPSBudWxsO1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBkYXRhID0gSlNPTi5wYXJzZShjb2RlKTtcblxuICAgICAgICAgICAgZGF0YS5maXh0dXJlcy5mb3JFYWNoKGZpeHR1cmVTcmMgPT4gUmF3VGVzdEZpbGVDb21waWxlci5fYWRkRml4dHVyZSh0ZXN0RmlsZSwgZml4dHVyZVNyYywgdGhpcy5iYXNlVXJsKSk7XG5cbiAgICAgICAgICAgIHJldHVybiB0ZXN0RmlsZS5nZXRUZXN0cygpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBHZW5lcmFsRXJyb3IoUlVOVElNRV9FUlJPUlMuY2Fubm90UGFyc2VSYXdGaWxlLCBmaWxlbmFtZSwgZXJyLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19